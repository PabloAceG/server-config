---
- include: ../../common/docker.yml

- name: Create Docker network for dashboard
  docker_network:
    name: dashboard

- name: Create Docker Prometheus folder
  file:
    path: /etc/docker/prom/prometheus/conf
    state: directory

- name: Copy Prometheus Docker Compose
  copy:
    src: "{{ playbook_dir }}/prometheus/prometheus-docker-compose.yml"
    dest: /etc/docker/prom/prometheus

- name: Move configuration files
  copy:
    src: "{{ item }}"
    dest: /etc/docker/prom/prometheus/conf
  loop:
    #- "{{ playbook_dir }}/prometheus/sources/alert.yml"
    - "{{ playbook_dir }}/prometheus/sources/prometheus.yml"

- name: Tear down existing Prometheus container
  docker_compose:
    project_src: /etc/docker/prom/prometheus
    files:
      - prometheus-docker-compose.yml
    state: absent

- name: Run Prometheus container
  docker_compose:
    project_src: /etc/docker/prom/prometheus
    files:
      - prometheus-docker-compose.yml

 # TODO: Include wait for and container state must be running
