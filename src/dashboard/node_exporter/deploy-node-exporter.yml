---
- include: ../../common/docker.yml

- name: Create Docker Node Exporter folder
  file:
    path: /etc/docker/prom/node_exporter
    state: directory

- name: Copy Node Exporter Docker compose folder
  copy:
    src: "{{ playbook_dir }}/node_exporter/node-exporter-docker-compose.yml"
    dest: /etc/docker/prom/node_exporter

- name: Tear down existing Node Exporter container
  docker_compose:
    project_src: /etc/docker/prom/node_exporter
    files:
      - node-exporter-docker-compose.yml
    state: absent

- name: Run Node Exporter container
  docker_compose:
    project_src: /etc/docker/prom/node_exporter
    files:
      - node-exporter-docker-compose.yml

# TODO: Include wait_for and container state must be running
